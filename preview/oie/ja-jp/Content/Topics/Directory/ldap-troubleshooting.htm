<?xml version="1.0" encoding="utf-8"?> <html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:onlyLocalStylesheets="False" MadCap:searchable="True" MadCap:fileTags="Tags/okta-authors.Rob Gray" MadCap:conditions="MultiProdPubish.OIE+Core">
    <head>
        <title>[[[Undefined variable Heading.Level1]]] | Okta</title>         <link href="" rel="stylesheet" type="text/css" /> <meta name="description" content="LDAPの問題のトラブルシューティングには、Okta LDAPエージェントのログ情報またはApache Directory StudioなどのLDAPブラウザーを使用します。" />     <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head>
    <body>
        <h1>LDAP統合のトラブルシューティング</h1>
        <p>LDAPの問題をトラブルシューティングするには、<b>Apache Directory Studio</b>などのLDAPブラウザーを入手してください。</p>
        <p>スキーマ・テンプレートは一般的な値に基づく提案であることに注意してください。LDAP環境はそれぞれ固有であり、デフォルト値を環境固有の設定で上書きする必要がある場合があります。Apache Directory Studioを使用して既存のユーザーやグループの属性を調べてテンプレートの値を確認することや、適切な設定を選択することができます。</p>
        <p>テンプレートを変更すると、テンプレートのすべてのデフォルト値が変更されます。上書きした設定は変更されません。</p>         <br /> <MadCap:dropDown> <MadCap:dropDownHead> <MadCap:dropDownHotspot>エージェントのインストール時のエラー</MadCap:dropDownHotspot> </MadCap:dropDownHead> <MadCap:dropDownBody>                 <p>エージェントのインストール中、&#160;&#160;<b>[アクセスを許可]</b>をクリックした後に、次のエラー・メッセージが&#160;表示される：</p>
                <p style="font-style: italic;">「Oktaからの応答の解析に失敗し、エージェントを登録できません。エラー・コード12。」</p>
                <p>ログを確認し、次のエントリーを探します：</p>
                <p style="font-family: 'Courier New';">javax.net.ssl.SSLHandshakeException: java.security.cert.CertificateException: No valid public key found in certificate chain.</p>
                <p>ログに上記のエントリーが含まれる場合、&#160;Java&#160;LDAPエージェント&#160;<b>・バージョン5.3.1</b>&#160;以降のインストールを試みている可能性があり、エージェントによるSSL証明書ピンニングのサポートによってOktaサーバーと通信できない環境となっています。&#160;これは、多くの場合、<b>SSLプロキシー</b>に依存する環境で発生します。この場合にインストールを完了できるようにするために、Oktaでは、ドメイン<i>okta.com</i>を許可リストに追加して、SSLプロキシー処理をバイパスすることを推奨しています。</p>
                <p>また、以下の説明に従ってSSLピンニングを無効にすることもできますが、これを行うと、<i>エージェントが提供するセキュリティー強化も無効になる</i>ため注意が必要です。</p>
                <p>SSL証明書ピンニングのサポートを無効にするには、ご使用のオペレーティング・システムに応じて以下の手順を実行します。</p>
                <h4>Windows</h4>
                <p>コマンド・ラインからOkta&#160;LDAP Agentをインストールします。</p>
                <ol>
                    <li>ホスト・サーバーで、<b>スーパー</b>管理者権限を持つOkta管理者アカウントを使用してOktaにサインインし、管理コンソールにアクセスします。</li>
                    <li>次の手順を実行して、Okta&#160;LDAP Agentをダウンロードします。<ol style="list-style-type: lower-alpha;"><li><MadCap:snippetText src="../../Resources/Snippets/task steps/Directory_nav.flsnp" /><b>[ディレクトリー統合]</b>。</li><li><b>[ディレクトリーを追加] &gt; [LDAPディレクトリーを追加]</b>をクリックします。</li><li>インストール要件を確認し、&#160;<b>[LDAPのセットアップ]</b>をクリックします。</li><li><b>[エージェントをダウンロード]</b>をクリックし、<b>[EXEインストーラーをダウンロード]</b>を選択して、Windowsサーバーにこれをダウンロードします。</li></ol></li>
                    <li>コマンド・ラインを開き、次のコマンドを実行します。</li>
                </ol>
                <p style="font-family: 'Courier New';text-align: left;margin-left: 40px;">OktaADAgentSetup.exe OktaDisableSslPinning=<b>1</b></p>
                <ol MadCap:continue="true">
                    <li>インストールを完了します。<ol style="list-style-type: lower-alpha;"><li><b>「このアプリがこのコンピューターに変更を加えることを許可しますか？」</b>というメッセージが表示されたら、&#160;<b>[はい]</b>をクリックします。</li><li>&#160;<b>[次へ]</b>をクリックします。</li><li>ライセンス契約に同意して、<b>[次へ]</b>をクリックします。</li><li>デフォルトのインストール・フォルダーの場所をそのまま使用するか、<b>[参照]</b>をクリックして別の場所を選択し、<b>[インストール]</b>をクリックします。</li><li>任意：LDAP over SSL（LDAPS）を有効にする場合は、&#160;<MadCap:xref href="ldap-agent-enable-LDAP-SSL.htm">[LDAP over SSLを有効にする]</MadCap:xref>を選択して、この手順を続行します。</li><li>LDAP構成画面で、次の情報を入力します。<ul><li><b>[LDAPサーバー]</b>：&#160;LDAPホストとポートを<i style="font-weight: bold;">host:port</i>の形式で入力します。例：<b style="font-style: italic;">ldap.mycompany.com:389</b>。</li><li><b>[ルートDN]</b>：&#160;ユーザーおよびグループの検索元となるDITのルート識別名。</li><li><b>[バインドDN]</b>：&#160;エージェントがLDAPディレクトリーに接続するために使用するバインドLDAPユーザーの識別名。</li><li><b>[バインド・パスワード]</b>：エージェントがLDAPディレクトリーに接続するために使用するバインド識別名のパスワード。</li><li>任意：&#160;<b>[SSL接続を使用する]</b>：&#160;LDAP over SSL（LDAPS）を有効にする場合に選択します。（<b>注：</b><MadCap:xref href="ldap-agent-enable-LDAP-SSL.htm">[LDAP over SSLを有効にする]</MadCap:xref>の手順を実行せずにこの&#160;オプションを選択すると、エラー<b>「指定したLDAPサーバーに接続できませんでした」</b>が表示されます。）</li></ul></li></ol></li>
                </ol>
                <ol MadCap:continue="true">
                    <li><b>[次へ]</b>をクリックします。</li>
                    <li>	任意：[Okta LDAP Agentプロキシー構成]ページでOkta&#160;LDAP Agentのプロキシー・サーバーを入力し、<b>[次へ]</b>をクリックします。</li>
                </ol>
                <p style="text-align: left;margin-left: 40px;">LDAPプロキシー・サーバーが独自のスキーマを返す場合は、プロキシー・サーバーのスキーマとLDAPサーバーのスキーマが異なると、ユーザー・データのインポート時に問題が発生する可能性があります。データのインポートの問題を回避するには、LDAPプロキシー・サーバーとLDAPサーバーのスキーマが同一であることを確認してください。</p>
                <ol MadCap:continue="true">
                    <li>	Okta&#160;LDAP AgentをOktaサービスに登録するには、Oktaサブドメイン名を入力し、</b>[次へ]<b>をクリックします。</li>
                    <li>	<b>Oktaのサインイン</b>・ページで、Okta管理者アカウントのユーザー名とパスワードを入力し、<b>[サインイン]</b>をクリックします。</li>
                    <li>	&#160;<b>[アクセスを許可]</b>&#160;をクリックして&#160;Okta APIにアクセスします。<b>注</b>：エラー・メッセージが表示される場合は、<MadCap:xref href="ldap-agent-log-info.htm">「Okta&#160;LDAPエージェント・ログの特定」</MadCap:xref>を参照してください。</li>
                    <li>	<b>[終了]</b>をクリックします。</li>
                    <li>LDAP統合設定を構成します。</li>
                </ol>
                <p>SSL証明書ピンニングのサポートが無効になっていて再度有効にする場合：</p>
                <ol>
                    <li>ADエージェント構成ファイルを見つけて開きます。<p style="font-family: 'Courier New';">C:\Program Files (x86)\Okta\Okta AD Agent\<b>OktaAgentSetup.exe.config</b></p></li>
                </ol>
                <ol MadCap:continue="true">
                    <li>SSLピンニングの有効化設定をTrueに変更します。<p style="font-family: 'Courier New';">"SslPinningEnabled" value="<b>True</b>"</p></li>
                </ol>
                <ol MadCap:continue="true">
                    <li>構成ファイルを保存して、エージェントを再起動します。</li>
                </ol>
                <h4>Linux</h4>
                <ol>
                    <li>コマンド・ラインで、SSL&#160;ピンニング有効化&#160;設定をfalseに変更します。<p style="font-family: 'Courier New';">$ sudo /opt/Okta/OktaLDAPAgent/scripts/configure_agent.sh -sslPinningEnabled false</p></li>
                </ol>
                <ol MadCap:continue="true">
                    <li>構成ファイルを保存して、エージェントを再起動します。</li>
                </ol>
                <p>インストールの完了後にSSL証明書ピンニングのサポートを再度有効にするには、<b>OktaLDAPAgent.conf</b>を開き、SSL&#160;ピンニング有効化&#160;設定を<b style="font-family: 'Courier New';">true</b>に変更します。</p>
                <p>SSL証明書ピンニングの詳細については、<a href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning">「Webアプリケーション・セキュリティー・プロジェクトを開く」</a>の記事を参照してください。</p>             </MadCap:dropDownBody> </MadCap:dropDown> <br /> <MadCap:dropDown> <MadCap:dropDownHead> <MadCap:dropDownHotspot> <a name="ImportLDAPRoleObjects"> </a>LDAPロール・オブジェクトをインポートできない</MadCap:dropDownHotspot> </MadCap:dropDownHead> <MadCap:dropDownBody>                 <h3>ユース・ケース</h3>
                <p>                     <i>LDAPディレクトリーに新しいロールを作成したが、JITが有効になっていても、ロールに割り当てられたユーザーがOktaにサインインしたときに、そのロールがOktaにインポートされない。</i> </p>
                <h4>LDAPロールがOktaに取り込まれるタイミング</h4>
                <p>LDAPロールは、JIT中ではなく、インポート中にのみOktaに取り込まれます。LDAPロールは、Oktaに取り込まれた後、グループとして表されます。</p>
                <h4>LDAPグループがOktaに取り込まれるタイミング</h4>
                <p>LDAPグループは、インポート中およびJIT中にOktaに取り込まれます。</p>
                <h3>回避策</h3>
                <p>すべてのユーザー・アカウントをOktaにインポートしたくない場合は、プレビュー組織に次の回避策のいずれかを実装することを検討してください。期待した結果が得られた場合は、本番組織に回避策を実装できます。</p>
                <h4>特定のLDAPロールと同じメンバーシップを持つグループをOktaにインポートする</h4>
                <ol>
                    <li>
                        <p>インポートするLDAPのロールと同じメンバーシップを持つグループをLDAPに作成します。</p>
                    </li>
                    <li>
                        <p>JITプロビジョニングまたはLDAPインポートのいずれかを使用して、そのグループとそのメンバーシップをOktaに取り込み、目的のアプリケーションまたは統合に割り当てます。</p>
                    </li>
                </ol>
                <h4>不要なオブジェクトを確認せずにOktaへのLDAPインポートを実行する</h4>
                <ol>
                    <li>
                        <p>Oktaで、<b>[ディレクトリー] &gt; [ディレクトリー統合] &gt; [LDAP] &gt; [設定] &gt; [インポート設定]</b>に移動します。</p>
                    </li>
                    <li>
                        <p><b>[一致ルールをインポート]</b>セクションで、<b>[一致が見つからない場合]</b>まで下にスクロールし、<b>[新しいユーザーを手動で確認する]</b>を選択します。これにより、インポートの実行時に新しいユーザー・アカウントがOktaに自動的に作成されることがなくなります。</p>
                    </li>
                    <li>
                        <p>LDAPディレクトリーに対してインポートを実行して、ステップ1で作成したグループをインポートします。グループ・メンバーは、後ほどOktaへのJIT時にグループに追加されます。</p>
                    </li>
                </ol>
                <h4>非アクティブなLDAPアカウントを一時的に分離する</h4>
                <p>LDAPディレクトリーに非アクティブなユーザー・アカウントが多数含まれているためにインポートを実行したくない場合、インポート前に次の回避策を実行して、非アクティブである可能性のあるアカウントを特定し、それらを分離できます。</p>
                <ol>
                    <li>
                        <p>LDAPディレクトリーに対して属性<span style="font-family: 'Courier New';">lastlogon</span>（または非アクティブなアカウントをフィルタリングする別の属性）のクエリーを実行します。</p>
                    </li>
                    <li>
                        <p>非アクティブなユーザー・オブジェクトを同期コンテナーの外部に移動して、インポート中にOktaに導入されないようにします。インポートの終了後にこれらのオブジェクトを元の場所に移動できます。</p>
                    </li>
                </ol>             </MadCap:dropDownBody> </MadCap:dropDown> <br /> <MadCap:dropDown> <MadCap:dropDownHead> <MadCap:dropDownHotspot>ユーザー名の確認時のエラー</MadCap:dropDownHotspot> </MadCap:dropDownHead> <MadCap:dropDownBody>                 <p>ユーザー名を確認するときに、次のエラーが表示される：</p>
                <p style="font-style: italic;">「ユーザー名：必要なパターンと一致しません」</p>
                <p>ユーザー名はメール形式にする必要があります。インポート設定が正しく設定されていることを確認します。<a href="ldap-agent-install-configure.htm">「Okta LDAPエージェントをインストールして構成する」</a>を参照してください。</p>             </MadCap:dropDownBody> </MadCap:dropDown> <br /> <MadCap:dropDown> <MadCap:dropDownHead> <MadCap:dropDownHotspot>SSLチェック・ボックスをオンにした後のエラー</MadCap:dropDownHotspot> </MadCap:dropDownHead> <MadCap:dropDownBody>                 <p> <b>[SSL接続を使用する]</b>チェック・ボックスをオンにすると、次のエラーが発生する：</p>
                <p style="font-style: italic;">「指定したLDAPサーバーに接続できませんでした」というメッセージが表示される。</p>
                <p>LDAP over SSL（LDAPS）が有効になっていることを確認してください。<a href="ldap-agent-enable-LDAP-SSL.htm">「LDAP over SSLを有効にする」</a>を参照してください。</p>             </MadCap:dropDownBody> </MadCap:dropDown> <br /> <br /> <br />     </body>
</html>

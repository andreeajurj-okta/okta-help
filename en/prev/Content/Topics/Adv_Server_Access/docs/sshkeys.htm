<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_okta_html5_topnav" data-mc-search-type="Stem" data-mc-help-system-file-name="okta_help.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="">
    <head>
        <meta name="typeofcontent" content="documentation" />
        <meta name="audience" content="admin" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>SSH Architecture</title>
        <link rel="shortcut icon" href="../../../Resources/Images/favicon.ico" type="image/x-icon" />
        <script>/* <![CDATA[ */
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-15777010-10', 'auto');
			ga('send', 'pageview');

		/* ]]> */</script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/okta-main.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.expand-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/expand-all-non-hover-sm.png') no-repeat center center, linear-gradient(#fff, #fff);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/collapse-all-non-hover-sm.png') no-repeat center center, linear-gradient(#fff, #fff);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div>
                        <nav class="title-bar tab-bar" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../ReleaseNotes/okta-relnotes.htm" alt="Okta"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <div class="LeftRightTopRow">
                                    <div>
                                        <div class="is-not-in-mobile">
                                        </div>
                                        <div class="toolbar-main">
                                            <div class="buttons popup-container clearfix topicToolbarProxy _Skins_okta_toolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                <div class="button-group-container-left">
                                                    <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                        <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <p />
                                    </div>
                                </div>
                                <div class="LeftRightMenu">
                                    <div>
                                        <div class="body-main">
                                            <h1>SSH Architecture</h1>
                                            <h2>Public Key Authentication</h2>
                                            <p>SSH provides a mechanism to authenticate <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">users<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>In Okta literature, we generally refer to "users" as the people who serve as Okta administrators. When we refer to "end users" we are generally referring to the people who the administrators serve. That is, those who use Okta chiclets to access their apps, but have no administrative control.</span></a> with public/private key pairs.<sup>(<a href="https://simple.wikipedia.org/wiki/Public-key_cryptography">1</a>)</sup>
The user has a private key, and they provide their public key to the server.
When the user attempts to login, the server sends a session identifier to the
<a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">client<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>Essentially, a client is anything that talks to the Okta service. Within the traditional client-server model, Okta is the server. The client might be an agent, an Okta mobile app, or a browser plugin. </span></a>. The client can then prove that it has a secret key by generating a
digital signature which contains this random session identifier and the public
key.<sup>(<a href="https://tools.ietf.org/html/rfc4252#section-7">2</a>)</sup> If the user can prove they have the private key of a public key that
the server knows to authorize, they are authenticated.</p>
                                            <p>This mechanism for authentication is considerably more secure than using
passwords, because the difficulty of guessing a password is fairly trivial
compared to the difficulty of guessing a private key.<sup>(<a href="https://help.ubuntu.com/community/SSH/OpenSSH/Keys">3</a>, <a href="https://en.wikipedia.org/wiki/Password_strength">4</a>, <a href="https://en.wikipedia.org/wiki/Key_(cryptography)">5</a>)</sup></p>
                                            <p>Public key authentication is not ideal though, and has its own challenges. For
one, the server must be made aware of the public keys to authorize in advance.
For another, the server has no control over how the user secures their private
key. The user is free to use a weak password, or even a completely unencrypted
(no password) private key.</p>
                                            <h2>Certificate Based Authentication</h2>
                                            <p>Certificate based SSH authentication is essentially an extension to public key
authentication.<sup>(<a href="http://cvsweb.openbsd.org/cgi-bin/cvsweb/src/usr.bin/ssh/PROTOCOL.certkeys?annotate=HEAD">6</a>)</sup> However, with certificate based authentication, the
server is not required to know the public key in advance. Instead, the server
is configured with a trusted Certificate Authority (CA) certificate, and it
uses that certificate to validate that a client's public key has been signed by
that trusted CA. This way, the user presents both their public key, and proof
that they have the private key corresponding to that public key all in one
step.  (The public key is included in the message the client signs to prove it
has the private key.) This method of authentication is a significant
improvement over "regular" public key authentication because every server you
have does not need to be made aware in advance of every public key it should
authorize.</p>
                                            <p>However, there are still some problems to be addressed. Specifically,
servers blindly trust any signed key for the duration of that signature, and
synchronizing revocation lists or otherwise revoking certificates is
non-trivial. Further, there is still no control over the private keys being
used, nor how well protected those keys are. For example, a user could have checked their
private key into a public git repository, and for the lifetime of
the certificate, anyone can use it to login.</p>
                                            <p> <span class="okta-feature-namesScaleFT">Advanced Server Access</span> uses certificate based authentication, and solves the problems of key
management and certificate revocation by issuing ephemeral credentials with
certificates that expire within minutes. No revocation lists are
required because <em>every</em> certificate we issue expires within minutes, and so
are "revoked" automatically. Because keys are also ephemeral, and
only ever signed once, if a user went out of their way to grab one and commit
it into a public git repository, that key is rendered useless within minutes.</p>
                                            <h2>Host-key Validation</h2>
                                            <p>Authenticating that a user is who they claim to be is obviously important, but
it is equally important that the user verify the authenticity of the host they
are connecting to.<sup>(<a href="http://link.springer.com/chapter/10.1007/978-3-0348-8295-8_17">7</a>)</sup> If the user cannot authenticate the host they are
connecting to, all the user-validation in the world is easily circumvented with
something called a "Man-in-the-Middle" (MitM) attack.<sup>(<a href="https://www.giac.org/paper/gsec/2034/conducting-ssh-man-middle-attacks-sshmitm/103515">8</a>, <a href="https://www.blackhat.com/presentations/bh-usa-03/bh-us-03-ornaghi-valleri.pdf">9</a>)</sup></p>
                                            <img alt="MitM" src="static/MitM.png" style="max-height: 142px;" />
                                            <p>While MitM attacks are somewhat confounded by the fact that session-ids are
negotiated via key-exchange algorithms<sup>(<a href="https://simple.wikipedia.org/wiki/Diffie-Hellman_key_exchange">10</a>)</sup> and public key authentication
requires that the session-id be included in the signed message<sup>(<a href="https://tools.ietf.org/html/rfc4252#section-7">2</a>)</sup>, such
attacks are still possible (e.g., in cases where you forward your ssh-<a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">agent<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>A software agent is a lightweight program that runs as a service outside of Okta. It is typically installed behind a firewall and allows Okta to tunnel communication between an on-premises service and Okta's cloud service. Okta employs several agent types: Active Directory, LDAP, RADIUS, RSA, Active Directory Password Sync, and IWA. For example, users can install multiple Active Directory agents to ensure that the integration is robust and highly available across geographic locations.</span></a> to
the malicious host, or in cases where a weak KEX is used<sup>(<a href="https://weakdh.org/">11</a>)</sup>). Essentially,
the user's client connects to a machine they believe is the target-host, but is
really just a server that pretends to be that target-host.  This imposter
(the MitM) uses whatever mechanisms it can to authenticate as the user; either
by exploiting the user's forwarded ssh-agent, or by <em>somehow</em> forcing the
negotiation of the same session-id it already negotiated with the target-host.
Once logged in, this MitM can do anything it likes up to, and including sending
any commands it wants as though the user had input them; all without ever
seeing the private key.</p>
                                            <p>The SSH Protocol has a solution for this problem called host-key validation,
and it is essentially the same thing as the Public Key Authentication explained
above, but backwards. The server authenticates itself to the client by proving
that it has the private key corresponding to a public key known to the client.
The problem with this solution is that the public key must be known to the
client in advance. (Just as with public key authentication before certificate
based authentication.) As a solution to this, certificate-based host-key
validation is also supported in openssh, but getting revocations to client
machines is considerably less reliable than getting them to servers, which was
already a hard problem.</p>
                                            <p>By providing a secure, out-of-band mechanism to exchange the public key of all
your hosts,  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> ensures that your SSH client will always have the correct
host-keys necessary to authenticate target hosts and establish a secure
connection. This completely avoids the "Trust On First Use" (TOFU) problem most
SSH users experience the first time they connect to a host, and they must
blindly trust that the key they are presented with is valid for that host.</p>
                                            <div class="terminal">
                                                <div class="terminal-toolbar"><span class="terminal-circle red"></span><span class="terminal-circle yellow"></span><span class="terminal-circle green"></span>
                                                </div>
                                                <div class="terminal-content">
                                                    <div>The authenticity of host 'web0.example.com (198.51.100.12)' can't be established.
RSA key fingerprint is SHA256:v8SbZC97NSdqqj8rEJ+dvK7yh47ex53n8vVfW8Lf/G0.
Are you sure you want to continue connecting (yes/no)?</div>
                                                </div>
                                            </div>
                                            <p>ScaleFT obtains the server's public host key directly from the source, and then
ensures your client is configured with that public key, all securely over TLS
at every step.</p>
                                            <p>Before  <span class="okta-feature-namesScaleFT">Advanced Server Access</span>, you may have just accepted:
</p>
                                            <div class="terminal">
                                                <div class="terminal-toolbar"><span class="terminal-circle red"></span><span class="terminal-circle yellow"></span><span class="terminal-circle green"></span>
                                                </div>
                                                <div class="terminal-content">
                                                    <div>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</div>
                                                </div>
                                            </div>
                                            <p>as something you see when you re-image a machine, or spin up a new instance
with the same name as a prior instance, with  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> this warning becomes rare,
meaningful, and you should definitely not proceed if you see it.</p>
                                            <hr width="100%" size="0" align="center" />
                                            <ol>
                                                <li value="1"><a href="https://simple.wikipedia.org/wiki/Public-key_cryptography">https://simple.wikipedia.org/wiki/Public-key_cryptography</a>
                                                    <br />
                                                </li>
                                                <li value="2"><a href="https://tools.ietf.org/html/rfc4252#section-7">https://tools.ietf.org/html/rfc4252#section-7</a>
                                                    <br />
                                                </li>
                                                <li value="3"><a href="https://help.ubuntu.com/community/SSH/OpenSSH/Keys">https://help.ubuntu.com/community/SSH/OpenSSH/Keys</a>
                                                    <br />
                                                </li>
                                                <li value="4"><a href="https://en.wikipedia.org/wiki/Password_strength">https://en.wikipedia.org/wiki/Password_strength</a>
                                                    <br />
                                                </li>
                                                <li value="5"><a href="https://en.wikipedia.org/wiki/Key_(cryptography)">https://en.wikipedia.org/wiki/Key_(cryptography)</a>
                                                    <br />
                                                </li>
                                                <li value="6"><a href="http://cvsweb.openbsd.org/cgi-bin/cvsweb/src/usr.bin/ssh/PROTOCOL.certkeys?annotate=HEAD">http://cvsweb.openbsd.org/cgi-bin/cvsweb/src/usr.bin/ssh/PROTOCOL.certkeys?annotate=HEAD</a>
                                                    <br />
                                                </li>
                                                <li value="7"><a href="http://link.springer.com/chapter/10.1007/978-3-0348-8295-8_17">http://link.springer.com/chapter/10.1007/978-3-0348-8295-8_17</a>
                                                    <br />
                                                </li>
                                                <li value="8"><a href="https://www.giac.org/paper/gsec/2034/conducting-ssh-man-middle-attacks-sshmitm/103515">https://www.giac.org/paper/gsec/2034/conducting-ssh-man-middle-attacks-sshmitm/103515</a>
                                                    <br />
                                                </li>
                                                <li value="9"><a href="https://www.blackhat.com/presentations/bh-usa-03/bh-us-03-ornaghi-valleri.pdf">https://www.blackhat.com/presentations/bh-usa-03/bh-us-03-ornaghi-valleri.pdf</a>
                                                    <br />
                                                </li>
                                                <li value="10"><a href="https://simple.wikipedia.org/wiki/Diffie-Hellman_key_exchange">https://simple.wikipedia.org/wiki/Diffie-Hellman_key_exchange</a>
                                                    <br />
                                                </li>
                                                <li value="11"><a href="https://weakdh.org/">https://weakdh.org/</a>
                                                    <br />
                                                </li>
                                            </ol><a href="#" class="sf-back-to-top"><span class="arrow"></span>Top</a>
                                        </div>
                                    </div>
                                    <div>
                                        <div data-sticky-container="" id="ew9I0iNLQUaRzclNx__rTg">
                                            <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="ew9I0iNLQUaRzclNx__rTg:top" data-bottom-anchor="contentBody:bottom" data-scroll-container=".body-container" data-sticky-on="only screen and (min-width: 1025px)" data-scroll-container-on="only screen and (min-width: 1025px)">
                                                <ul class="nocontent menu _Skins_okta_side_menu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/BrowseSequences/BrowseSequences__secondary.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="False" data-mc-include-parent="True" data-mc-toc="True">
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="Footer">
                                    <div>
                                        <p class="copyright">© Copyright <span class="okta-variablesYear">2019</span> <span class="okta-variablesCompanyName">Okta, Inc</span></p>
                                    </div>
                                </div>
                                <script src="../../../Resources/Scripts/js/app.js">
                                </script>
                                <!-- <script src="../../Resources/Scripts/js/vendor/jquery.js"></script> -->
                                <script src="../../../Resources/Scripts/js/vendor/what-input.js">
                                </script>
                                <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.4-rc1/js/foundation.min.js">
                                </script>
                                <script type="text/javascript" src="../../../Resources/Scripts/back-to-top.js">
                                </script>
                                <script type="text/javascript" src="../../../Resources/Scripts/get-feedback.js">
                                </script>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>
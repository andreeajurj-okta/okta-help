<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_okta_html5_topnav" data-mc-search-type="Stem" data-mc-help-system-file-name="okta_help.xml" data-mc-path-to-help-system="../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="typeofcontent" content="documentation" />
        <meta name="audience" content="admin" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Setup Access Gateway using Microsoft Azure | Okta</title>
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, height=device-height" />
        <link rel="shortcut icon" href="../../Resources/Images/favicon.ico" type="image/x-icon" />
        <!-- Google Tag Manager -->
        <script>
			/* <![CDATA[ */
			(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], 
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-TJ45R6');
			/* ]]> */
		</script>
        <!-- End Google Tag Manager -->
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/okta-main.css" rel="stylesheet" />
        <link href="https://static.cloud.coveo.com/searchui/v2.5395/css/CoveoFullSearchNewDesign.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.expand-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/expand-all-non-hover-sm.png') no-repeat center center, linear-gradient(#fff, #fff);
}

.button.collapse-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/collapse-all-non-hover-sm.png') no-repeat center center, linear-gradient(#fff, #fff);
}

.needs-pie
{
	behavior: url('../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../Resources/TableStyles/standard.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="https://support.okta.com/help/s/" alt="Okta"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="2" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <!-- Coveo config parameters -->
                                    <div id="coveo_org_id" style="Display:None"><span class="okta-coveo-configOrgId">oktaproduction9ounvcxa</span>
                                    </div>
                                    <div id="coveo_rest_uri" style="Display:None"><span class="okta-coveo-configPlatformRestUri">https://platform.cloud.coveo.com/rest/search</span>
                                    </div>
                                    <div id="coveo_search_url" style="Display:None"><span class="okta-coveo-configSearchPageUrl">https://support.okta.com/help/s/global-search/%40uri</span>
                                    </div>
                                    <div id="coveo_token_url" style="Display:None"><span class="okta-coveo-configSearchTokenServiceUrl">https://support.okta.com/help/services/apexrest/PublicSearchToken?site=help</span>
                                    </div>
                                    <!-- End Coveo config parameters -->
                                    <!-- ************************* Coveo Search bar ************************************* -->
                                    <div id="OLC_Coveo_Headline" class="coveo-headline-wrapper">
                                        <div class="slds-p-vertical_small">
                                            <!--Search Bar-->
                                            <div class="slds-grid slds-grid_align-center">
                                                <div id="customSelect" class="CoveoCustomSelect slds-float_right">
                                                </div>
                                                <div id="standaloneSearchbox">
                                                    <div class="CoveoAnalytics" data-search-hub="OktaCommunityFullSearch">
                                                    </div>
                                                    <div class="CoveoTab" data-id="Help" data-caption="Help" style="display:none">
                                                    </div>
                                                    <div class="CoveoSearchbox" data-enable-omnibox="true" data-enable-query-suggest-addon="true">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- **********************  Main content row  ********************** -->
                                    <div class="okta-topics">
                                        <!-- *** Col1: Left Nav Col *** -->
                                        <div class="is-not-in-mobile">
                                            <div data-sticky-container="" id="bxnufBO2b0iUsLWs8b7kaw">
                                                <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="bxnufBO2b0iUsLWs8b7kaw:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                    <ul class="nocontent menu _Skins_okta_left_menu mc-component" data-mc-linked-toc="Data/Tocs/left_nav_TOC.js" data-mc-side-menu="True" data-mc-max-depth="2" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- *** Col2: Body Col *** -->
                                        <div>
                                            <div class="is-not-in-mobile">
                                                <!-- Breadcrumbs -->
                                            </div>
                                            <div class="toolbar-main">
                                                <!-- Expand/Collapse All for drop-downs -->
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_okta_toolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="body-main">
                                                <!-- Main content body -->
                                                <h1>Setup Access Gateway using Microsoft Azure</h1>
                                                <hr width="100%" size="0" align="center" />
                                                <h2><a name="Overview"></a>Overview</h2>
                                                <p>The purpose of this guide is to walk through the process of installing the Access Gateway software appliance into a Microsoft Azure instance. </p>
                                                <hr width="100%" size="0" align="center" />
                                                <h2><a name="Prerequisites"></a>Prerequisites</h2>
                                                <ul style="list-style-type: square;">
                                                    <li value="1">You have reviewed all <a href="pre-install-requirements.htm" class="MCXref xref">Prerequisites for Deploying Access Gateway</a></li>
                                                    <li value="2">You’re familiar with Azure GUI and cli, commands and concepts.<br />Wherever possible both the UI and CLI instructions are provided. </li>
                                                    <li value="3">You have installed <a href="https://www.virtualbox.org/">Virtual Box v6.0</a> or later. </li>
                                                    <li value="4">The <b>qemu</b> virtual disk utility. <br />The qemu disk utility is available for a variety of operating systems and can be found <a href="https://www.qemu.org/download/">here</a>. <br /></li>
                                                    <li value="5">The latest version of <b>azcopy</b> <br />Azcopy is only required if uploading disk images using the command line.<br />Follow the directions <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10">here</a> to download and install an operating system appropriate version of <b>azcopy</b>. <br /></li>
                                                    <li value="6">You have installed and are familiar with the Microsoft Azure CLI.<br />Those intending to ONLY&#160;use the console UI&#160;need not install the Microsoft Azure CLI&#160;support.<br />See <a href="setup-ms-azure-cli.htm" class="MCXref xref">Setup Microsoft Azure Command Line interface</a> for an introduction to downloading and configuring the Microsoft Azure CLI.</li>
                                                </ul>
                                                <hr width="100%" size="0" align="center" />
                                                <h2><a name="What’s"></a>What’s covered in this guide</h2>
                                                <div>
                                                    <p> In order to use the OVA&#160;with Microsoft Azure we must:</p>
                                                    <ol style="list-style-type: square;">
                                                        <li value="1"><a href="#Download_OVA" class="MCXref xref">Download the latest OVA&#160;image.</a>
                                                        </li>
                                                        <li value="2"><a href="#PrepareImage" class="MCXref xref">Prepare Image</a>
                                                        </li>
                                                        <li value="3"><a href="#DefineResourceGroup" class="MCXref xref">Define a resource group</a>
                                                        </li>
                                                        <li value="4"><a href="#CreateDisk" class="MCXref xref">Create Microsoft Azure Managed Disk</a>
                                                        </li>
                                                        <li value="5"><a href="#Create_VM" class="MCXref xref">Create VM</a>
                                                        </li>
                                                    </ol>
                                                </div>
                                                <hr width="100%" size="0" align="center" />
                                                <div>
                                                    <h2><a name="Download_OVA"></a>Download the latest OVA&#160;image.</h2>
                                                    <p>To download the latest Okta Access Gateway OVA Image:</p>
                                                    <ol>
                                                        <li value="1">
                                                            <p>Login to your Okta <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">Org<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>The Okta container that represents a real-world organization.</span></a> as <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">Admin<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>An abbreviation of administrator. This is the individual(s) who have access to the Okta Administrator Dashboard. They control the provisioning and deprovisioning of end users, the assigning of apps, the resetting of passwords, and the overall end user experience. Only administrators have the Administration button on the upper right side of the My Applications page.</span></a>. </p>
                                                        </li>
                                                        <li value="2">
                                                            <p>Download the Okta Access Gateway image from the <b>Settings &gt; Downloads</b> page.</p>
                                                        </li>
                                                        <li value="3">
                                                            <p>When prompted save the file to an appropriate location.</p>
                                                        </li>
                                                    </ol>
                                                </div>
                                                <div>
                                                    <hr width="100%" size="0" align="center" />
                                                    <h2><a name="PrepareImage"></a>Prepare Image</h2>
                                                    <p>Microsoft Azure cannot import the Access Gateway OVA unchanged. <br />To prepare the image we must:</p>
                                                    <ul>
                                                        <li value="1">Import the and configure Virtual Box Image Settings</li>
                                                        <li value="2">Export the image</li>
                                                    </ul>
                                                    <p>&#160;</p>
                                                    <p>Import the and configure Virtual Box Image Settings:</p>
                                                    <ol>
                                                        <li value="1">Start <b>VirtualBox</b></li>
                                                        <li value="2">Import the OVA<ol style="list-style-type: lower-alpha;"><li value="1">Choose <b>File &gt; Import Appliance</b></li><li value="2">Navigate to the directory containing the downloaded Access Gateway OVA file, and click <b>Open</b></li><li value="3">In the <i>Appliance Settings</i> dialog specify the following values:<br /><table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/standard.css');" class="TableStyle-srb_header" cellspacing="0"><col style="width: 187px;" class="TableStyle-srb_header-Column-Column1" /><col style="width: 50%;" class="TableStyle-srb_header-Column-Column1" /><thead><tr class="TableStyle-srb_header-Head-Header1"><th class="TableStyle-srb_header-HeadF-Column1-Header1">Field</th><th class="TableStyle-srb_header-HeadD-Column1-Header1">Value</th></tr></thead><tbody><tr class="TableStyle-srb_header-Body-Body1"><td class="TableStyle-srb_header-BodyF-Column1-Body1"><b>Name</b></td><td class="TableStyle-srb_header-BodyD-Column1-Body1">An appropriate name for the OVA such as <b>AccessGateway4.5</b></td></tr><tr class="TableStyle-srb_header-Body-Body2"><td class="TableStyle-srb_header-BodyC-Column1-Body2">MAC&#160;Address Policy</td><td class="TableStyle-srb_header-BodyA-Column1-Body2">Generae New MAC&#160;addresses for all network adapters<br /><img src="../../Resources/Images/access-gateway/setup-oci-vbox.02.png" /></td></tr></tbody></table></li><li value="4">Click <b>Continue</b>. </li><li value="5">Click <b>Import</b>.<br />Wait for the import to complete.</li></ol></li>
                                                        <li value="3">From the virtual machine list, select the name of the Virtual Machine just imported.</li>
                                                        <li value="4">Right click the VM name and choose <b>Start &gt; Normal Start</b>.<br />Wait for the Access Gateway instance to start.</li>
                                                        <li value="5">Enable DHCP<ol style="list-style-type: lower-alpha;"><li value="1">Login to the instance using the <b>oag-mgmt</b> account. </li><li value="2">At the command prompt select <b>1 - Networking</b>.</li><li value="3">Select 2 - Setup dhcp networking.</li><li value="4">At the Enable DHCP prompt enter <b>y</b>.</li><li value="5">Enter <b>x</b> to return to the main menu.</li></ol></li>
                                                        <li value="6">Export the updated OVA<ol style="list-style-type: lower-alpha;"><li value="1">In the Access Gateway command console enter <b>5 - System</b></li><li value="2">Select <b>6 - Shutdown.</b></li><li value="3">Enter <b>y </b>to confirm the shutdown<b>.<br /></b>Wait as the gateway appliance shuts down<b>. </b></li><li value="4">Right click and choose <b>Export to OCI</b>.</li><li value="5">Select Open Virtualization Format 2.0.</li><li value="6">Ensure that the file name for the export ends in OVA.</li><li value="7">Under <b>MAC&#160;Address Policy,</b> select <b>Include all network adapter MAC addresses</b>.</li><li value="8">Click <b>Continue</b></li><li value="9">Click <b>Export</b>. </li></ol></li>
                                                        <li value="7">Exit Virtual Box</li>
                                                        <li value="8">Convert virtual disk<ol style="list-style-type: lower-alpha;"><li value="1"><p>Convert the virtual disk from VDI (the default) to VHD format</p><pre style="background-color: #dcdcdc;">vboxmanage clonehd &lt;path-to-existing-virtual-disk&gt; &lt;name-of-new-vhd-disk&gt; --format VHD</pre><p>For example, under MACOSX<br /><pre id="code">cd ~/VirtualBoxVMs/OAG4.5<br />vboxmanage clonehd oag-2019.4.5-1e8896b-disk1.vdi oag-2019.4.5-1e8896b-disk1.vhd --format VHD</pre><br /></p></li><li value="2"><p>Convert the VHD to .<b>raw</b> format</p><pre id="code"><span style="font-weight: normal;">qemu-img convert -f vpc -O raw &lt;path-to-VHD-disk&gt; &lt;name-of-new-raw-disk&gt;</span></pre><p>For example, under MACOSX<br /><pre id="code">qemu-img convert -f vpc -O raw oag-2019.4.5-1e8896b-disk1.vhd oag-2019.4.5-1e8896b-disk1.raw</pre><br /></p></li><li value="3"><p>Convert back to .<b>vhd</b> format, but fixed. </p><pre id="code">qemu-img convert -f raw -o subformat=fixed -O vpc &lt;path-to-new-raw-disk&gt; &lt;name-of-new-vhd-disk&gt;</pre></li><li value="4"><p>For example, under MACOSX<br /><pre id="code">qemu-img convert -f raw -o subformat=fixed -O vpc oag-2019.4.5-1e8896b-disk1.raw oag-2019.4.5-1e8896b-disk1.fixed.vhd</pre><br /></p></li></ol></li>
                                                    </ol>
                                                </div>
                                                <div>
                                                    <hr width="100%" size="0" align="center" />
                                                    <h2><a name="DefineResourceGroup"></a>Define a resource group</h2>
                                                    <p>Microsoft Azure uses resource <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">groups<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>Groups allow you to organize your end users and the apps they can access. Assigning apps to large sets of end users is made easier with groups.</span></a> to contain related resources.  Access Gateway VM and disk must be created within the same resource group</p>
                                                    <ol>
                                                        <li value="1">Create a resource group.<ol style="list-style-type: lower-alpha;"><li value="1">Login to the Microsoft Azure Portal</li><li value="2">From the top left menu Resource Groups.</li><li value="3">Click <b>+ Add</b> to add a new resource group.</li><li value="4">In the <i>Basics</i> pane enter a name and choose an appropriate region to house the group.<br />If you have multiple subscriptions you may also select a subscription.<br /><img src="../../Resources/Images/access-gateway/setup-using-ovf-azure.01.png" id="img_new" /><br /></li><li value="5">Click <b>Review +&#160;create</b></li><li value="6">Click <b>Create</b>. </li></ol><div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />To create a resource group at the command line:</a></span><div class="MCDropDownBody dropDownBody"><ol style="list-style-type: lower-alpha;"><li value="1">Login or return to the Microsoft Azure command line interface.<br /><pre id="code">az login</pre></li><li value="2">Using the <b>az account list-locations</b> command list all known locations and select one. <br />Optionally list the details of a specific region using <b>--location locationame.</b><br /><pre xml:space="preserve" id="code"> az account list-locations [--location eastus]</pre>				Which should output resembling:<br /><pre xml:space="preserve" id="code">[{<br />    "displayName": "East US",<br />    . . .  
     "name": "eastus",<br />   },{. . . }]</pre> From the list, select an appropriate region, identified by the <b>name</b> field.</li><li value="3">Create a resource group within a given location using the <b style="font-family: 'Courier New';">az group create </b> command. &#160;:<pre xml:space="preserve" id="code">az group create -l <i>&lt;location&gt;</i> -n <i>&lt;name&gt;</i></pre><br />Where:
					
					<ul><li value="1"><b style="font-style: italic;">location</b> is a region code.</li><li value="2"><b style="font-style: italic;">name</b> is an appropriate name.</li></ul><br />For example:<br /><pre xml:space="preserve" id="code">az group create -l <i>eastus</i> -n <i>AccessGateway</i></pre><br />Which should result a result resembling:<br /><pre xml:space="preserve" id="code">{<br />   "id": "/subscriptions/. . . /resourceGroups/AccessGateway",<br />   "location": "eastus",<br />   "managedBy": null,<br />   "name": "AccessGateway", . . . <br />   "type": "Microsoft.Resources/resourceGroups"<br />}<br /></pre></li></ol></div></div><p>&#160;</p></li>
                                                    </ol>
                                                </div>
                                                <div>
                                                    <hr width="100%" size="0" align="center" />
                                                    <h2><a name="CreateDisk"></a>Create Microsoft Azure Managed Disk</h2>
                                                    <p>Microsoft Azure VMs are a combination of disk images and Virtual Machine definitions.</p>
                                                    <p>To create an Microsoft Azure managed disk</p>
                                                    <ul>
                                                        <li value="1">Create a an empty managed disk</li>
                                                        <li value="2">Populate the managed disk with the converted Access Gateway disk</li>
                                                    </ul>
                                                    <ol>
                                                        <li value="1">Create an empty managed disk<ol style="list-style-type: lower-alpha;"><li value="1">Login or return to the Microsoft Azure Portal</li><li value="2">In the upper left hand menu click <b>+&#160;Create a resource</b>.</li><li value="3">Using Search search for <b>Managed Disks</b>.</li><li value="4">Under <i>Managed Disks</i> click <b>Create</b>. </li><li value="5">In the <i>Create</i> managed disk pane enter a disk name, and select a resource group from the resource group drop down. </li><li value="6">Click <b>Change size</b> to select an appropriate size, no less then the size of the previously created VHD disk.</li><li value="7">Click <b>Review +&#160;create</b>.</li></ol><div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />To create a disk at the command line</a></span><div class="MCDropDownBody dropDownBody"><ol style="list-style-type: lower-alpha;"><li value="1">Login or return to the Microsoft Azure command line interface.<br /><pre id="code">az login</pre></li><li value="2">Using the <span style="font-family: 'Courier New'; font-weight: bold;">az disk create</span> command create a disk large enough to contain the OVA&#160;disk file. <br /><pre xml:space="preserve" id="code">az disk create -n &lt;<i>virtual-disk</i>&gt; -g &lt;<i>resource-group</i>&gt; -l &lt;<i>location</i>&gt; --for-upload --upload-size-bytes <i>&lt;size</i>&gt; --sku standard_lrs</pre><br /><p>Where: </p><ul><li value="1"><b>&lt;virtual-disk&gt;</b> is the name of the virtual disk - typically the same as the OVA&#160;disk without suffix.</li><li value="2"><b>&lt;resource-group&gt;</b> is the name of the previously created resource group. For example, <i>AccessGateway</i>.</li><li value="3"><b>&lt;location&gt;</b> is the location of the resource group. For example <i>eastus</i>. </li><li value="4"><b>&lt;size&gt;</b> is the size of the disk in bytes. For example 236223201792.</li><p>and </p><li value="5"><b style="font-family: 'Courier New';">--sku standard_lrs</b> is a required parameter<br /></li></ul><p>For example:<br /></p><pre xml:space="preserve" id="code">az disk create -n <i>Okta-AccessGateway-2019.4.5</i> -g <i>OAG</i> -l <i>eastus</i> --for-upload --upload-size-bytes <i>236223201792</i> --sku standard_lrs</pre></li></ol></div></div><p id="code">Which will produce results resembling:<br /><pre xml:space="preserve" style="background-color: #d3d3d3;">{<br />    "creationData": {<br />    "createOption": "Upload",<br />    "imageReference": null,<br />    "sourceResourceId": null,<br />    "sourceUniqueId": null,<br />    "sourceUri": null,<br />    "storageAccountId": null,<br />    "uploadSizeBytes": 20972032<br />    },. . . <br />    "tags": {}, <br />    "timeCreated": "2019-12-20T17:51:29.894626+00:00",<br />    "type": "Microsoft.Compute/disks",<br />    "uniqueId": "d1485574-. . . ",<br />    "zones": null<br />}<br /></pre><div class="noteOkta"><img src="../../Resources/Images/assets/Icons/Notes/Help.png" class="noteImgFloat" title="Info" alt="Info" /><p class="noteHeading">Note</p><p>The file size of the created disk must match exactly the file size used when copying up the disk image. <br />Use a command such as <span style="font-family: 'Courier New'; font-weight: bold;">ls -l</span> (linux) or <span style="font-family: 'Courier New'; font-weight: bold;">dir</span> (Windows) to determine the file size in bytes. </p></div></p></li>
                                                        <li value="2">Populate the empty disk<ol style="list-style-type: lower-alpha;"><li value="1">Login or return to the Microsoft Azure Portal</li><li value="2">In the upper left hand menu click <b>Storage Accounts</b>.</li><li value="3"><p>Select the storage account where the Security Access Manager VHD file will be uploaded to.</p><p>If you do not have a storage account, click <b>Add</b> to create one.</p></li><li value="4">Under <b>BLOB SERVICE</b>, click <b>Containers</b>.</li><li value="5">Select the container to house the VHD&#160;file.<br />If you do not have a container click <b>+ Container</b> to create one. </li><li value="6">Click Upload and navigate to the location of the VHD file.</li><li value="7">From the <i>Blob type</i> drop down select <b>Page Blob</b>.</li><li value="8">Click <b>Upload</b>. <br />Note: Upload time will vary based on disk size and upload speed.</li></ol><p>&#160;</p><div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />To populate a disk using the command line</a></span><div class="MCDropDownBody dropDownBody"><div class="noteOkta"><img src="../../Resources/Images/assets/Icons/Notes/Help.png" class="noteImgFloat" title="Info" alt="Info" /><p class="noteHeading">Note</p><p>The following section requires the use of <span style="font-family: 'Courier New';">azcopy</span>. Follow the directions <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10">here</a> to download and install an operating system appropriate version of <span style="font-family: 'Courier New';">azcopy</span></p></div><ol style="list-style-type: lower-alpha;"><li value="1">Using <b>az disk grant-access</b> access to create an Shared Access Token which can be used to grant access to the previously created disk<br /><pre xml:space="preserve" id="code"> az disk grant-access -n <b style="font-style: italic; font-weight: normal;">&lt;virtual-disk&gt;</b> -g <b style="font-style: italic; font-weight: normal;">&lt;resource-group&gt;</b> --access-level Write --duration-in-seconds 86400</pre><br />Where:<br /><ul><li value="1"><b>&lt;virtual-disk&gt;</b> is the name of the virtual disk </li><li value="2"><b>&lt;resource-group&gt;</b> is the name of the previously created resource group. </li><p>and </p><li value="3"><b style="font-family: 'Courier New';">--access-level Write</b> is the required write access level</li><li value="4"><b style="font-family: 'Courier New';">--duration-in-seconds 86400</b> in the lifetime of the Shared Access Token in seconds.<br /></li></ul><br />for example:<br /><pre xml:space="preserve" id="code"> az disk grant-access -n <b style="font-style: italic; font-weight: normal;">Okta-AccessGateway-2019.4.5</b> -g <i>OAG</i> --access-level Write --duration-in-seconds 86400</pre><p>Which will produce results resembling:<br /><pre xml:space="preserve" id="code">"accessSas": "https://md-. . . VY1SlQ79TOnwoMaVHjaqkmVlU%3D"</pre></p></li><li value="2">Upload the disk file using the <b style="font-family: 'Courier New';">azcopy copy</b> command<br /><pre xml:space="preserve" id="code">azcopy copy <i>&lt;path-to-disk&gt;</i> "<i>&lt;accessSas&gt;</i>" --blob-type PageBlob</pre> Where:<br /><ul><li value="1"><b>&lt;path-to-disk&gt;</b> is the fully qualified path to the fixed disk previously created.</li><li value="2"><b>&lt;accessSas&gt;</b> is the value from the <b style="font-family: 'Courier New';">az disk grant-access</b> command. </li></ul><br /><br /><div class="noteOkta"><img src="../../Resources/Images/assets/Icons/Notes/Help.png" class="noteImgFloat" title="Info" alt="Info" /><p class="noteHeading">Note</p><p class="noteContent">Azcopy uses the <span style="font-family: 'Courier New';">AZCOPY_CONCURRENCY_VALUE</span> environment variable to control the upload process. <br />Setting this variable to <b style="font-family: 'Courier New';">AUTO</b> causes Azcopy to attempt to optimize the upload process. <br /></p></div><br />For example:<pre xml:space="preserve" id="code">export AZCOPY_CONCURRENCY_VALUE=AUTO<br />azcopy copy <i>Okta-AccessGateway-2019.4.5</i> "<i>https://md-. . . VY1SlQ79TOnwoMaVHjaqkmVlU%3D</i>" --blob-type PageBlobexample</pre><br />				Which will produce results similar to:<br /><pre id="code">INFO: Scanning...<br />Job 50d659dd-6174-fe4d-78b1-5f97e305fdee has started<br />Log file is located at: ~/.azcopy/50d659dd-6174-fe4d-78b1-5f97e305fdee.log<br />INFO: Trying 4 concurrent connections (initial starting point)<br />INFO: Trying 16 concurrent connections (seeking optimum)           <br />. . . <br />INFO: Trying 5 concurrent connections (at optimum)                                     <br />. . .<br />Elapsed Time (Minutes): 78.9381<br />Total Number Of Transfers: 1<br />Number of Transfers Completed: 1<br />. . . <br />TotalBytesTransferred: 236223201792<br style="font-weight: normal;" />Final Job Status: Completed<br /></pre></li><li value="3">Revoke access to the using <b>az disk revoke</b><br /><pre xml:space="preserve" id="code">az disk revoke-access -n &lt;<i>virtual-disk</i>&gt; -g &lt;<i>resource-group</i>&gt;</pre>Where:<br /><ul><li value="1"><b>&lt;virtual-disk&gt;</b> is the name of the virtual disk </li><li value="2"><b>&lt;resource-group&gt;</b> is the name of the previously created resource group. </li></ul><p>For example:</p><pre xml:space="preserve" id="code">az disk revoke-access -n <i>oag-2019-12-30-disk1.fixed.vhd</i> -g <i>OAG </i></pre></li></ol></div></div></li>
                                                    </ol>
                                                </div>
                                                <div>
                                                    <hr width="100%" size="0" align="center" />
                                                    <h2><a name="Create_VM"></a>Create VM</h2>
                                                    <p>To create an Microsoft Azure virtual machine</p>
                                                    <ul>
                                                        <li value="1">Define a virtual machine</li>
                                                        <li value="2">Associate the previously created disk with the new virtual machine,</li>
                                                    </ul>
                                                    <ol>
                                                        <li value="1">Create a VM<br /><ol style="list-style-type: lower-alpha;"><li value="1">Login or return to the Microsoft Azure Portal</li><li value="2">In the upper left corner menu select <b>All Services</b> and search for <b>Virtual Machines.</b> <br />Alternatively select <b>Virtual Machines</b> from the favorites list.</li><li value="3">Click <b>+&#160;Add</b></li><li value="4">In the Create a virtual machine page:<ul><li value="1">Select a resource group from the <i>Resource group</i> dropdown.</li><li value="2">In the <i>Virtual machine name</i> field enter a name for the new VM. </li><li value="3">In the <i>Region</i> field select the region containing the previously created managed disk.</li><li value="4">In the <b>Image</b> drop down select 'Cent OS-Based 7.7'</li><li value="5">In <b>Size</b> select an appropriate image size. </li></ul></li><li value="5">Click <b>Next:&#160;Disks &gt;</b>.</li><li value="6">Click <b>Attach a existing disk</b> and select the previously added disk.</li><li value="7">Click <b>Create and review</b>.</li><li value="8">Examine the new VM and determine its external IP&#160;address,</li></ol><p>&#160;</p><div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />To create a VM at the command line</a></span><div class="MCDropDownBody dropDownBody"><ol style="list-style-type: lower-alpha;"><li value="1">Create a VM&#160;using the az vm create command<br /><pre id="code">az vm create --resource-group &lt;<i>resource-group</i>&gt; --location &lt;<i>region</i>&gt; --name &lt;<i>name-of-VM</i>&gt; --os-type linux --attach-os-disk &lt;<i>virtual-disk</i>&gt;</pre><br />Where:
					<ul><li value="1"><b>&lt;region&gt;</b> is the region to hold the VM</li><li value="2"><b>&lt;name-of-vm&gt;</b> is an name for the VM</li><li value="3"><b>&lt;virtual-disk&gt;</b> is the name of the virtual disk to associate with the VM</li><li value="4"><b>&lt;resource-group&gt;</b> is the name of the previously created resource group to house the VM</li></ul><p>For example:</p><pre id="code">az vm create --resource-group OAG -location eastus --name OAG4.5 --os-type linux --attach-os-disk oag-2019-12-30-disk1.fixed.vhd</pre><p>				Which will produce results similar to:</p><pre xml:space="preserve" id="code"> --running<br />										
					</pre></li></ol></div></div></li>
                                                    </ol>
                                                </div>
                                                <hr width="100%" size="0" align="center" />
                                                <div>
                                                    <h2><a name="Related_Topics"></a>Next Steps</h2>
                                                    <p>After Okta Access Gateway has been installed there are a number of common post installation tasks that should be performed. <br />		Including:
			</p>
                                                    <ul>
                                                        <li value="1"><a href="setup-post-install.htm#Determine_IPAddress">Determine the IP Address of the Okta Access Gateway virtual application.</a>
                                                        </li>
                                                        <li value="2"><a href="setup-post-install.htm#ConfigureLocal">Configure admin <span style="font-family: 'Courier New';">/etc/hosts</span> entry</a>
                                                        </li>
                                                        <li value="3"><a href="setup-post-install.htm#Initialize_Verify">Initialize the Command Line console</a>
                                                        </li>
                                                        <li value="4"><a href="setup-post-install.htm#Reset_Passwords">Reset Passwords</a>
                                                        </li>
                                                        <li value="5"><a href="setup-post-install.htm#InitializeUI">Initialize Access Gateway Admin UI&#160;Console</a>
                                                        </li>
                                                        <li value="6"><a href="setup-post-install.htm#ConfigureDNS">Configure DNS</a>
                                                        </li>
                                                        <li value="7"><a href="setup-post-install.htm#Add_Applications">Add Applications</a>
                                                        </li>
                                                    </ul>
                                                    <div>
                                                        <h2><a name="More_Information"></a>For More Information</h2>
                                                        <ul>
                                                            <li value="1">See <a href="setup-post-install.htm" class="MCXref xref">Okta Access Gateway Post Installation</a> for a complete task list.</li>
                                                            <li value="2">See  <a href="command-line-console-reference.htm" class="MCXref xref">Access Gateway Command Line Management Console Reference</a> for a complete list of management console commands.</li>
                                                            <li value="3">See <a href="admin-ui-console-overview.htm" class="MCXref xref">Access Gateway Admin UI Console Overview</a> for an overview of the Access Gateway UI&#160;console.</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <!-- Back to Top button --><a href="#" class="sf-back-to-top"><span class="arrow"></span>Top</a>
                                            </div>
                                        </div>
                                        <!-- *** Col3: Right menu Col *** -->
                                        <div class="is-not-in-mobile">
                                        </div>
                                    </div>
                                    <!-- ***************************** Footer rows ********************************* -->
                                    <div class="footer-temp">
                                        <div class="is-not-in-mobile">
                                            <p> </p>
                                        </div>
                                        <div>
                                            <p class="copyright">©  <span class="okta-variablesYear">2020</span> <span class="okta-variablesCompanyName">Okta, Inc</span> All Rights Reserved. Various trademarks held by their respective owners.</p>
                                        </div>
                                    </div>
                                    <!-- ***************************** Scripts ************************************* -->
                                    <!-- Foundation -->
                                    <script src="../../Resources/Scripts/js/app.js">
                                    </script>
                                    <script src="../../Resources/Scripts/js/vendor/what-input.js">
                                    </script>
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.4-rc1/js/foundation.min.js">
                                    </script>
                                    <!-- Ours -->
                                    <script type="text/javascript" src="../../Resources/Scripts/back-to-top.js">
                                    </script>
                                    <script type="text/javascript" src="../../Resources/Scripts/get-feedback.js">
                                    </script>
                                    <!-- Coveo -->
                                    <script src="https://static.cloud.coveo.com/searchui/v2.5395/js/CoveoJsSearch.Lazy.min.js">
                                    </script>
                                    <script src="../../Resources/Scripts/coveo-resources/js/cultures/en.js" id="coveoCultureScript">
                                    </script>
                                    <script src="../../Resources/Scripts/coveo-resources/js/Coveo.MadcapFlare.RequireJS.js" id="coveoRequireScript">
                                    </script>
                                    <script src="../../Resources/Scripts/coveo-resources/js/Coveo.MadcapFlare.Okta.js" id="coveoInitscript">
                                    </script>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>
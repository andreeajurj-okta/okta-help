<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_okta_html5_topnav" data-mc-search-type="Stem" data-mc-help-system-file-name="okta_help.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Documentation|Product documentation|Adv. Server Access|Reference">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="typeofcontent" content="documentation" />
        <meta name="audience" content="admin" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Set Up Advanced Server Access on Windows | Okta</title>
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, height=device-height" />
        <link rel="shortcut icon" href="../../../Resources/Images/favicon.ico" type="image/x-icon" />
        <!-- Google Tag Manager -->
        <script>
			/* <![CDATA[ */
			(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], 
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-TJ45R6');
			/* ]]> */
		</script>
        <!-- End Google Tag Manager -->
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/okta-main.css" rel="stylesheet" />
        <link href="https://static.cloud.coveo.com/searchui/v2.5395/css/CoveoFullSearchNewDesign.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.expand-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/expand-all-non-hover-sm.png') no-repeat center center, linear-gradient(#fff, #fff);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/collapse-all-non-hover-sm.png') no-repeat center center, linear-gradient(#fff, #fff);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="https://support.okta.com/help/s/" alt="Okta"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="2" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <!-- Coveo config parameters -->
                                    <div id="coveo_org_id" style="Display:None"><span class="okta-coveo-configOrgId">oktaproduction9ounvcxa</span>
                                    </div>
                                    <div id="coveo_rest_uri" style="Display:None"><span class="okta-coveo-configPlatformRestUri">https://platform.cloud.coveo.com/rest/search</span>
                                    </div>
                                    <div id="coveo_search_url" style="Display:None"><span class="okta-coveo-configSearchPageUrl">https://support.okta.com/help/s/global-search/%40uri</span>
                                    </div>
                                    <div id="coveo_token_url" style="Display:None"><span class="okta-coveo-configSearchTokenServiceUrl">https://support.okta.com/help/services/apexrest/PublicSearchToken?site=help</span>
                                    </div>
                                    <!-- End Coveo config parameters -->
                                    <!-- ************************* Coveo Search bar ************************************* -->
                                    <div id="OLC_Coveo_Headline" class="coveo-headline-wrapper">
                                        <div class="slds-p-vertical_small">
                                            <!--Search Bar-->
                                            <div class="slds-grid slds-grid_align-center">
                                                <div id="customSelect" class="CoveoCustomSelect slds-float_right">
                                                </div>
                                                <div id="standaloneSearchbox">
                                                    <div class="CoveoAnalytics" data-search-hub="OktaCommunityFullSearch">
                                                    </div>
                                                    <div class="CoveoTab" data-id="Help" data-caption="Help" style="display:none">
                                                    </div>
                                                    <div class="CoveoSearchbox" data-enable-omnibox="true" data-enable-query-suggest-addon="true">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- **********************  Main content row  ********************** -->
                                    <div class="okta-topics">
                                        <!-- *** Col1: Left Nav Col *** -->
                                        <div class="is-not-in-mobile">
                                            <div data-sticky-container="" id="gHP4S1wKv0uuGZNjcY0pKA">
                                                <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="gHP4S1wKv0uuGZNjcY0pKA:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                    <ul class="nocontent menu _Skins_okta_left_menu mc-component" data-mc-linked-toc="Data/Tocs/left_nav_TOC.js" data-mc-side-menu="True" data-mc-max-depth="2" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- *** Col2: Body Col *** -->
                                        <div>
                                            <div class="is-not-in-mobile">
                                                <!-- Breadcrumbs -->
                                                <div class="nocontent">
                                                    <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider="  &gt;  " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">  </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="toolbar-main">
                                                <!-- Expand/Collapse All for drop-downs -->
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_okta_toolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="body-main">
                                                <!-- Main content body -->
                                                <h1>Windows</h1>
                                                <h2>Overview</h2>
                                                <p>Using  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> with Windows requires installing the  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> Server Tools on the server, and <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">Client<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>Essentially, a client is anything that talks to the Okta service. Within the traditional client-server model, Okta is the server. The client might be an agent, an Okta mobile app, or a browser plugin. </span></a> Tools on the client.
See below for directions.</p>
                                                <p>Once the  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> Server Tools are installed on the server and the server is enrolled, the  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">Agent<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>A software agent is a lightweight program that runs as a service outside of Okta. It is typically installed behind a firewall and allows Okta to tunnel communication between an on-premises service and Okta's cloud service. Okta employs several agent types: Active Directory, LDAP, RADIUS, RSA, Active Directory Password Sync, and IWA. For example, users can install multiple Active Directory agents to ensure that the integration is robust and highly available across geographic locations.</span></a> (<code>sftd</code>) does two
things:</p>
                                                <ol>
                                                    <li value="1">Creates local accounts for all  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> users who should have access to the server, very similar to on Linux. On
Windows, these accounts are initially disabled.</li>
                                                    <li value="2">Runs an additional Access Broker which listens on port 4421.</li>
                                                </ol>
                                                <p>The Access Broker uses TLS 1.2 to authenticate all clients using client certificates that can only be issued by the
 <span class="okta-feature-namesScaleFT">Advanced Server Access</span> platform.</p>
                                                <h4>Connection Establishment</h4>
                                                <p>In order to establish an RDP connection, the  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> client:</p>
                                                <ol>
                                                    <li value="1">Communicates with  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> platform to get short-lived credentials it can use to authenticate to the Access Broker.</li>
                                                    <li value="2">Optionally establishes an SSH tunnel through any intermediate bastion servers. If any bastion also uses  <span class="okta-feature-namesScaleFT">Advanced Server Access</span>
for authentication, short-lived credentials are fetched transparently.</li>
                                                    <li value="3">Connects to the  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> broker (over the SSH tunnels, if applicable) and authenticates using the short-lived
certificate provided by the platform. The client also authenticates the server's host certificate against one
provided by the platform to defend against man-in-the-middle attacks.</li>
                                                    <li value="4">The client requests access to the user account on the server. At this point the Broker requests that the Agent
enable the user account.</li>
                                                    <li value="5">Negotiates a proxied RDP connection via the Broker. The client is then able to start a TCP server on a random port
on the client, which is proxied through the broker to the RDP service on the server.</li>
                                                    <li value="6">The client writes an RDP connection file containing the connection info, including the random local port on which
the client is now listening. It then opens the Windows Terminal Services client with this configuration.</li>
                                                </ol>
                                                <p>The RDP client connects to the local TCP port and is forwarded to the RDP service on the server. The RDP server is able
to automatically authenticate as the user without any further prompting.</p>
                                                <p>When the user logs out, the agent will automatically disable their account.</p>
                                                <h2>Configuration</h2>
                                                <h3>Server Configuration</h3>
                                                <p>Server configuration follows the same <a href="setup/enrolling-a-server.htm">principles</a> as it does on Linux.</p>
                                                <p>In order to enroll the server using an enrollment token, write the token to:</p><pre><code>C:\windows\system32\config\systemprofile\AppData\Local\scaleft\enrollment.token
</code></pre>
                                                <p>Alternatively if you are using AWS you can <a href="setup/enrolling-a-server.htm">associate your AWS account with a ScaleFT project.</a></p>
                                                <p> <span class="okta-feature-namesScaleFT">Advanced Server Access</span> Server Tools installers are available <a href="https://dist.scaleft.com/server-tools/windows/">here</a>.</p>
                                                <p> <span class="okta-feature-namesScaleFT">Advanced Server Access</span> Server Tools can be automatically installed on AWS using the following userdata script. If you are using an
enrollment token be sure to replace the value of <code>$enrollment_token</code>. If you have associated your AWS account with your
 <span class="okta-feature-namesScaleFT">Advanced Server Access</span> project, you can omit the first half of the script which is responsible for writing the enrollment token.</p><pre><code class="language-ps1">&lt;powershell&gt;
# Write the Enrollment Token
$enrollment_token = "ENROLLMENT TOKEN GOES HERE"
$enrollment_token_path = "C:\windows\system32\config\systemprofile\AppData\Local\scaleft\enrollment.token"
New-Item -ItemType directory -Path (Split-Path $enrollment_token_path -Parent)
$enrollment_token | Out-File $enrollment_token_path -Encoding "ASCII"

# Install  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> Server Tools
$installer_url = "https://dist. <span class="okta-feature-namesScaleFT">Advanced Server Access</span>.com/server-tools/windows/latest/ <span class="okta-feature-namesScaleFT">Advanced Server Access</span>-Server-Tools-latest.msi"
$installer_path = [System.IO.Path]::ChangeExtension([System.IO.Path]::GetTempFileName(), ".msi")
(New-Object System.Net.WebClient).DownloadFile($installer_url, $installer_path)
msiexec.exe /qb /I $installer_path
&lt;/powershell&gt;
</code></pre>
                                                <h3>Connecting to a Server</h3>
                                                <p>To RDP to a server using  <span class="okta-feature-namesScaleFT">Advanced Server Access</span> run:</p><pre><code>sft rdp &lt;server-name&gt;
</code></pre>
                                                <p>If you need to traverse one or more bastions use <code>--via</code> arguments, such as:</p><pre><code>sft rdp --via &lt;first.bastion&gt; --via &lt;second.bastion&gt; &lt;server&gt;
</code></pre>
                                                <h2>Advanced Server Configuration</h2>
                                                <h3>Paths</h3>
                                                <h5>State Directory</h5>
                                                <p><code>C:\Windows\System32\config\systemprofile\AppData\Local\scaleft</code>
                                                </p>
                                                <h5>Config File</h5>
                                                <p><code>C:\Windows\System32\config\systemprofile\AppData\Local\scaleft\sftd.yaml</code>
                                                </p>
                                                <h5>Log Directory</h5>
                                                <p><code>C:\Windows\System32\config\systemprofile\AppData\Local\scaleft\Logs</code>
                                                </p>
                                                <h5>Enrollment Token</h5>
                                                <p><code>C:\windows\system32\config\systemprofile\AppData\Local\scaleft\enrollment.token</code>
                                                </p>
                                                <h3>Configuration</h3>
                                                <p>The configuration format used by the agent is the same on Windows as it is on Linux. See the <a href="sftd.htm">sftd reference</a>
for details.</p>
                                                <!-- Back to Top button --><a href="#" class="sf-back-to-top"><span class="arrow"></span>Top</a>
                                            </div>
                                        </div>
                                        <!-- *** Col3: Right menu Col *** -->
                                        <div class="is-not-in-mobile">
                                            <div data-sticky-container="" id="qoMyAO_F2USroH4qTClxgA">
                                                <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="qoMyAO_F2USroH4qTClxgA:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                    <ul class="nocontent menu _Skins_okta_right_menu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/okta_TOC.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="False" data-mc-include-parent="True" data-mc-toc="True">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- ***************************** Footer rows ********************************* -->
                                    <div class="footer-temp">
                                        <div class="is-not-in-mobile">
                                            <p> </p>
                                        </div>
                                        <div>
                                            <p class="copyright">©  <span class="okta-variablesYear">2019</span> <span class="okta-variablesCompanyName">Okta, Inc</span> All Rights Reserved. Various trademarks held by their respective owners.</p>
                                        </div>
                                    </div>
                                    <!-- ***************************** Scripts ************************************* -->
                                    <!-- Foundation -->
                                    <script src="../../../Resources/Scripts/js/app.js">
                                    </script>
                                    <script src="../../../Resources/Scripts/js/vendor/what-input.js">
                                    </script>
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.4-rc1/js/foundation.min.js">
                                    </script>
                                    <!-- Ours -->
                                    <script type="text/javascript" src="../../../Resources/Scripts/back-to-top.js">
                                    </script>
                                    <script type="text/javascript" src="../../../Resources/Scripts/get-feedback.js">
                                    </script>
                                    <!-- Coveo -->
                                    <script src="https://static.cloud.coveo.com/searchui/v2.5395/js/CoveoJsSearch.Lazy.min.js">
                                    </script>
                                    <script src="../../../Resources/Scripts/coveo-resources/js/cultures/en.js" id="coveoCultureScript">
                                    </script>
                                    <script src="../../../Resources/Scripts/coveo-resources/js/Coveo.MadcapFlare.RequireJS.js" id="coveoRequireScript">
                                    </script>
                                    <script src="../../../Resources/Scripts/coveo-resources/js/Coveo.MadcapFlare.Okta.js" id="coveoInitscript">
                                    </script>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>